<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usrp UHD Api &mdash; USRP UHD API  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/msmb.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/js/versions.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="usrp_uhd_wrapper" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> USRP UHD API
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API description</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronisation.html">Synchronisation &amp; Communication Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Physical &amp; Network Setup</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">USRP UHD API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Usrp UHD Api</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usrp-uhd-api">
<h1>Usrp UHD Api<a class="headerlink" href="#usrp-uhd-api" title="Permalink to this heading">¶</a></h1>
<p>Welcome to the documentation of the Usrp Uhd API.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API description</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronisation.html">Synchronisation &amp; Communication Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Physical &amp; Network Setup</a></li>
</ul>
</div>
</section>
<section id="purpose">
<h1>Purpose<a class="headerlink" href="#purpose" title="Permalink to this heading">¶</a></h1>
<p>This repo wraps the <a class="reference external" href="https://github.com/EttusResearch/uhd">Universal Hardware Driver</a> (UHD) for <a class="reference external" href="https://www.ni.com/de-de/support/model.ettus-usrp-x410.html">USRP X410</a>. Since the authors of UHD point out that the driver is device-independent, this wrapper should support other USRPs out-of-the-box as well. It is to be noted that the configuration is different for the USRPs, therefore, some modifications most likely need to be made for other USRPs</p>
<p>We cover the following use-case: The USRP can be used with the full-mimo setup, i.e. four transmitting and four receiving antennas. The user creates the signal on his/her laptop, sends them <strong>as bursts</strong> to the USRP via network and collects the received samples. Post-processing happens on the laptop of the user. <strong>We strongly emphasize that this wrapper is not meant for streaming. On top of that, USRPs are mainly designed for streaming use-cases. Therefore some adjustments had to be made to the wrapper.</strong></p>
<p>This repository contains the <strong>client as well as the server code</strong>. The client is to be used by the user for signal processing purposes and sending the commands to the USRP, which serves as a server. The server code is to be deployed on the USRP. Once built and installed, the USRP does not need to be touched again.</p>
</section>
<section id="documentation">
<h1>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">¶</a></h1>
<p>Documentation can be found <a class="reference external" href="https://barkhausen-institut.github.io/usrp_uhd_wrapper/index.html">here</a>.</p>
<p>Read this in conjunction with our example files located in <strong>examples/</strong>!</p>
</section>
<section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<section id="usrp-is-already-setup">
<h2>USRP is already setup<a class="headerlink" href="#usrp-is-already-setup" title="Permalink to this heading">¶</a></h2>
<p>Assume somebody already deployed the USRP server code (cf. Install section) and gives you the IP address of the USRPs you may use. As a first step, you want to transmit some samples from USRP1 to USRP2.</p>
<p>Follow the Steps of Install/Client below to install the client. Afterwards proceed to the Examples section.</p>
</section>
<section id="usrp-is-not-setup">
<h2>USRP is not setup<a class="headerlink" href="#usrp-is-not-setup" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span></code> to the USRP and follow the steps of Install/Server below. Afterwards proceed with the steps of the previous section. Ensure that the USRP was restarted.</p>
</section>
</section>
<section id="install">
<h1>Install<a class="headerlink" href="#install" title="Permalink to this heading">¶</a></h1>
<section id="server">
<h2>Server<a class="headerlink" href="#server" title="Permalink to this heading">¶</a></h2>
<p>For installing the server on the USRP (needs to be done only once per USRP):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">&lt;this</span> <span class="pre">repo&gt;</span> <span class="pre">&amp;&amp;</span> <span class="pre">cd</span> <span class="pre">&lt;repo&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">env</span> <span class="pre">&amp;&amp;</span> <span class="pre">.</span> <span class="pre">env/bin/activate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">uhd_wrapper</span> <span class="pre">&amp;&amp;</span> <span class="pre">mkdir</span> <span class="pre">build</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">build</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DCMAKE_BUILD_TYPE=Release</span> <span class="pre">..</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-V</span></code> to check if the tests pass</p></li>
</ol>
<p>To start the usrp server as a service, run: <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">rpc-server.service</span></code>. Restart.
The USRP server needs a minute to start.</p>
</section>
<section id="client">
<h2>Client<a class="headerlink" href="#client" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Ensure that you use at least python3.9.</p></li>
<li><p>Create and activate virtual env (on linux: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">env</span> <span class="pre">&amp;&amp;</span> <span class="pre">.</span> <span class="pre">env/bin/activate</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code></p></li>
<li><p><strong>For running tests:</strong> <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements_tests.txt</span></code></p></li>
</ol>
</section>
</section>
<section id="before-use">
<h1>Before Use<a class="headerlink" href="#before-use" title="Permalink to this heading">¶</a></h1>
<section id="sanity-tests">
<h2>Sanity Tests<a class="headerlink" href="#sanity-tests" title="Permalink to this heading">¶</a></h2>
<p>For a quick check if the USRP’s RPC Server is running correctly and the connection can be established, we provide a sanity test script in the module <code class="docutils literal notranslate"><span class="pre">usrp_client.sanity</span></code> which can be run by:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>usrp_client.sanity<span class="w"> </span>--help
<span class="go">usage: sanity.py [-h] [--sync] [--trx] [--single] [--all] [--plot] --ips ip [ip ...] [--fc FC] [--tx-gain TX_GAIN]</span>
<span class="go">                 [--rx-gain RX_GAIN] [--fs FS] [--tx-port TX_PORT] [--rx-port RX_PORT] [--rx-antenna RX_ANTENNA]</span>

<span class="go">Run several sanity tests against USRPs</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>

<span class="go">Test selection:</span>
<span class="go">  --sync                Run the synchronization test against all USRPs (default: False)</span>
<span class="go">  --trx                 Run a transmission from first to second USRP in &lt;ips&gt; (default: False)</span>
<span class="go">  --single              Run a transmission on a single USRP (default: False)</span>
<span class="go">  --all                 Run all sanity tests (default: False)</span>
<span class="go">  --plot                Plot received signals (default: False)</span>

<span class="go">USRP configuration:</span>
<span class="go">  --ips ip [ip ...]     List of IPs to check</span>
<span class="go">  --fc FC               Carrier frequency in Hz (default: 3700000000.0)</span>
<span class="go">  --tx-gain TX_GAIN     TX gain in dB (default: 20)</span>
<span class="go">  --rx-gain RX_GAIN     RX gain in dB (default: 20)</span>
<span class="go">  --fs FS               Sampling rate in Hz (default: 245760000.0)</span>
<span class="go">  --tx-port TX_PORT     TX antenna port (default: 0)</span>
<span class="go">  --rx-port RX_PORT     RX antenna port (default: 0)</span>
<span class="go">  --rx-antenna RX_ANTENNA</span>
<span class="go">                        RX antenna name (TX/RX, RX1, ...) (default: RX1)</span>
</pre></div>
</div>
</section>
<section id="integration-tests">
<h2>Integration Tests<a class="headerlink" href="#integration-tests" title="Permalink to this heading">¶</a></h2>
<p>We provide integration tests, i.e. we run tests against the hardware covering some easy usecases (e.g., joint communication and sensing (JCAS), local transmission, peer-to-peer-transmission…). If you want to execute them, the environment variables <code class="docutils literal notranslate"><span class="pre">USRP1_IP</span></code> and <code class="docutils literal notranslate"><span class="pre">USRP2_IP</span></code> with the corresponding IP need to be set. Execute the command <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">.</span></code> or, if you just want to execute the hardware-related tests: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">.</span> <span class="pre">-m</span> <span class="pre">&quot;hardware&quot;</span></code>. <strong>It is highly recommended to execute these tests before conducting your measurements</strong>:</p>
<p>On client side:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;repo&gt;
$<span class="w"> </span>.<span class="w"> </span>env/bin/activate
$<span class="w"> </span><span class="nv">USRP1_IP</span><span class="o">=</span>&lt;usrp1-ip&gt;<span class="w"> </span><span class="nv">USRP2_IP</span><span class="o">=</span>&lt;usrp2-ip&gt;<span class="w"> </span>pytest<span class="w"> </span>.<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;hardware&quot;</span>
$<span class="w"> </span>pytest<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>
<section id="use">
<h1>Use<a class="headerlink" href="#use" title="Permalink to this heading">¶</a></h1>
<p>After install, there are two python packages installed: <code class="docutils literal notranslate"><span class="pre">usrp_client</span></code> serving as the client that sends commands (e.g. radio frontend (RF) config, samples, etc.) to the USRP server. The <code class="docutils literal notranslate"><span class="pre">uhd_wrapper.utils</span></code> package contains dataclasses for the configurations (module <code class="docutils literal notranslate"><span class="pre">config</span></code>) and some serialization functions in the <code class="docutils literal notranslate"><span class="pre">serialization</span></code> module.</p>
<p>Assuming you installed the client, always activate the virtual environment via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;repo&gt;
$<span class="w"> </span>.<span class="w"> </span>env/bin/activate
</pre></div>
</div>
<p><strong>Note</strong>: If you restart the USRP, the server needs a minute to start.</p>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h2>
<p>The <strong>examples</strong> directory contains some examples. In each example file, we will print if the sent signal can be found in the received frame. The printed delay should be more or less (i.e. +- 5 sampels) deterministic, depending on sample rate. All examples are to be run from the client side. <strong>Port 5555 is used.</strong> We add the option to plot signals. Examples should be self-explanatory.</p>
<p><strong>localhost_transmission</strong>: Sends random signal from a dedicated USRP to itself, check file.</p>
<p>Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>examples/localhost_transmission.py<span class="w"> </span>--usrp1-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--carrier-frequency<span class="w"> </span>&lt;carrier-frequency&gt;<span class="w"> </span>--plot
</pre></div>
</div>
<p><strong>usrp_p2p_transmission</strong>: Sends random signal from Usrp1 to Usrp2, check file.</p>
<p>Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>examples/usrp_p2p_transmission.py<span class="w"> </span>--usrp1-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--usrp2-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--carrier-frequency<span class="w"> </span>&lt;carrier-frequency&gt;<span class="w"> </span>--plot
</pre></div>
</div>
<p><strong>JCAS</strong>: Implements the JCAS scenario, but using a random signal instead.
Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>examples/jcas.py<span class="w"> </span>--usrp1-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--usrp2-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--carrier-frequency<span class="w"> </span>&lt;carrier-frequency&gt;<span class="w"> </span>--plot
</pre></div>
</div>
<p>Sends a random signal from USRP1 to USRP2, while receiving at USRP1 as well. If <code class="docutils literal notranslate"><span class="pre">--plot</span></code> argument is omitted, the signal will be sent/received 10 times a row.</p>
<p><strong>mimo_p2p_transmission</strong>: Implements a 4x4 MIMO scenario.
Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>examples/mimo_p2p_transmission.py<span class="w"> </span>--usrp1-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--usrp2-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>--carrier-frequency<span class="w"> </span>&lt;carrier-frequency&gt;<span class="w"> </span>--plot
</pre></div>
</div>
<p>Creates four random signals, that are distributed to the antennas. They are shifted by 10k samples. Usrp2 receives the signals at four antennas.</p>
</section>
<section id="hardware-tests">
<h2>hardware_tests<a class="headerlink" href="#hardware-tests" title="Permalink to this heading">¶</a></h2>
<p>We have some hardware tests, for testing/debugging purposes mainly. Samples are dumped as well for better analysis. They are to be run from the USRP directly. Files are located in the <strong>hardware_tests</strong> folder.</p>
<p><strong>Note</strong>: The Usrp service should be stopped for this purpose!</p>
</section>
</section>
<section id="for-developers">
<h1>For Developers<a class="headerlink" href="#for-developers" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>run <code class="docutils literal notranslate"><span class="pre">bumpversion</span> <span class="pre">major|minor|patch</span></code> to bump the version by one. It automatically creates a tag and tag commit. Make sure you are on the master branch.</p></li>
</ul>
</section>
<section id="authors">
<h1>Authors<a class="headerlink" href="#authors" title="Permalink to this heading">¶</a></h1>
<p>Authors are affiliated to the <a class="reference external" href="https://barkhauseninstitut.org">Barkhausen Institut</a>, namely <a class="reference external" href="https://github.com/tokr-bit">Tobias Kronauer</a> and <a class="reference external" href="https://github.com/mmatthebi">Maximilian Matthe</a></p>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-right" title="usrp_uhd_wrapper" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Connected Robotics Lab.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = ''
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>